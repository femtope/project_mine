function adjustLayerbyZoom(e){if(e>11){if(!GINAdmin2){map.addLayer(guineaAdminLayer2);for(var o=0;o<GINLabels.length;o++)GINLabels[o].addTo(map);GINAdmin2=!0}}else if(10>=e){map.removeLayer(guineaAdminLayer2);for(var o=0;o<GINLabels.length;o++)map.removeLayer(GINLabels[o]);GINAdmin2=!1}}function triggerUiUpdate(){societe=$("#societe_scope").val(),region=$("#region_scope").val(),prefecture=$("#prefecture_scope").val().toLowerCase(),substance=$("#substance_type").val(),console.log("All Seleceted: ",societe+"  "+region+"  "+prefecture+"  "+substance+"  "+date);var e=buildQuery(region,prefecture,societe,substance);download_query=e.replace("http:","https:").replace("format=GeoJSON&","")+"&format=CSV",document.getElementById("query").setAttribute("href",download_query),console.log("Query: ",e),getData(e),prefecture_select=$("#region_scope").val()}function buildQuery(e,o,r,t){var n=!1;return query="https://femtope.cartodb.com/api/v2/sql?format=GeoJSON&q=SELECT * FROM mine_guinea",console.log("Date in Query: ",date),e.length>0||o.length>0||r.length>0||t.length>0?(query=query.concat(" WHERE"),e.length>0&&(query=query.concat(" carriere_region = '".concat(e.concat("'"))),n=!0),o.length>0&&(query=query.concat(n?" AND carriere_prefecture = '".concat(o.concat("'")):" carriere_prefecture = '".concat(o.concat("'"))),n=!0),r.length>0&&(query=query.concat(n?" AND societe = '".concat(r.concat("'")):" societe = '".concat(r.concat("'"))),n=!0),t.length>0&&(query=query.concat(n?" AND substance = '".concat(t.concat("'")):" substance = '".concat(t.concat("'"))),n=!0)):query="https://femtope.cartodb.com/api/v2/sql?format=GeoJSON&q=SELECT * FROM mine_guinea",query}function addDataToMap(e){null!=dataLayer&&map.removeLayer(dataLayer),null!=markerGroup&&map.removeLayer(markerGroup);var o=L.icon({iconUrl:"image/dolerite.jpg",iconSize:[20,20],iconAnchor:[25,25]}),r=L.icon({iconUrl:"image/granite.jpg",iconSize:[20,20],iconAnchor:[25,25]}),t=L.icon({iconUrl:"image/calcaire.jpg",iconSize:[20,20],iconAnchor:[25,25]}),n=L.icon({iconUrl:"image/pouzzolane.jpg",iconSize:[20,20],iconAnchor:[25,25]});$("#projectCount").text(e.features.length),markerGroup=L.markerClusterGroup({showCoverageOnHover:!1,zoomToBoundsOnClick:!0,removeOutsideVisibleBounds:!0}),dataLayer=L.geoJson(e,{pointToLayer:function(e,a){if("Dol√©rite"==e.properties.substance)var i=L.marker(a,{icon:o});if("Granite"==e.properties.substance)var i=L.marker(a,{icon:r});if("Calcaire"==e.properties.substance)var i=L.marker(a,{icon:t});if("Pouzzolane"==e.properties.substance)var i=L.marker(a,{icon:n});return i},onEachFeature:function(e,o){e.properties&&e.properties.substance&&(o.bindPopup(e.properties.substance,{closeButton:!1,offset:L.point(0,-20)}),o.on("mouseover",function(){o.openPopup()}),o.on("mouseout",function(){o.closePopup()}),o.on("click",function(){displayInfo(e)}))}}),markerGroup.addLayer(dataLayer),map.fitBounds(dataLayer),map.addLayer(markerGroup)}function addAdminLayersToMap(e){var o={admin0:{clickable:!0,color:"#B81609",fillColor:"#ffffff",weight:2,opacity:1,fillOpacity:.05},admin2:{clickable:!0,color:"#412406",fillColor:"#80FFFFFF",weight:1.5,opacity:.5,fillOpacity:.05},region:{clickable:!0,color:"#e2095c",fillColor:"#80FFFFFF",weight:2,opacity:.7,fillOpacity:.05},prefecture:{clickable:!0,color:"#e2095c",fillColor:"#80FFFFFF",weight:2.5,opacity:.7,fillOpacity:.05}};regionSelect=$("#region_scope").val(),prefectureSelect=$("#prefecture_scope").val(),guineaAdminLayer0=L.geoJson(e.guineaAdmin0,{style:o.admin0}).addTo(map),guineaAdminLayer2=L.geoJson(e.guineaAdmin2,{style:o.region,onEachFeature:function(e,o){var r=L.divIcon({className:"labelLga-icon",html:e.properties.NAME_2});GINLabels.push(L.marker(o.getBounds().getCenter(),{icon:r}))}}),null!=region_layer&&map.removeLayer(region_layer),region_layer=L.geoJson(e.guineaAdmin1,{filter:function(e){return e.properties.NAME_1===regionSelect},style:o.region}).addTo(map),map.fitBounds(region_layer),null!=prefecture_layer&&map.removeLayer(prefecture_layer),prefecture_layer=L.geoJson(e.guineaAdmin2,{filter:function(e){return e.properties.NAME_2===prefectureSelect},style:o.region}).addTo(map),map.fitBounds(prefecture_layer),console.log("Zoom Level ",map.getZoom())}function displayInfo(e){var o=buildPopupContent(e);$("#infoContent").html(o)}function normalizeName(e){return e=e.replace("_"," ").replace("of_"," of "),e=e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}function buildPopupContent(e){for(var o="",r=["prenom_nom","fonction","carriere_region","carriere_prefecture","carriere_sous_prefecture","substance","societe","site","taxe_superficiaire","prenom_directeur","observation","production_total","email_directeur","telephone_directeur","substance","date_expiration","date_demande","prix_unitaire","quantite_vendu","emploi_expatrier_femme","emploi_expatrier_homme","emploi_direct_femme","emploi_direct_homme","date"],t=0;t<r.length;t++)o=o.concat("<p><strong>"+normalizeName(r[t])+": </strong>"+e.properties[r[t]]+"</p>");return o}function showLoader(){$(".fa-spinner").addClass("fa-spin"),$(".fa-spinner").show()}function hideLoader(){$(".fa-spinner").removeClass("fa-spin"),$(".fa-spinner").hide()}function getData(e){showLoader(),$.post(e,function(e){hideLoader(),addDataToMap(e),console.log("Data-Geo::  ",e)}).fail(function(){console.log("error!")})}function getAdminLayers(){var e={};$.get("resources/GIN_Admin0.json",function(o){e.guineaAdmin0=o,addAdminLayersToMap(e)}).fail(function(){logError(null)}),$.get("resources/GIN_Admin1.json",function(o){e.guineaAdmin1=o,addAdminLayersToMap(e)}).fail(function(){logError(null)}),$.get("resources/GIN_Admin2.json",function(o){e.guineaAdmin2=o,addAdminLayersToMap(e)}).fail(function(){logError(null)})}function logError(){console.log("error!")}function showPrefecture(){prefecture_show=document.getElementById("prefecture_id"),prefecture_show1=document.getElementById("prefecture_id1"),console.log("Show: ",prefecture_show),console.log("Show1: ",prefecture_show1),""!=prefecture_select?(prefecture_show.style.visibility="true",prefecture_show1.style.visibility="true"):(prefecture_show.style.visibility="hidden",prefecture_show1.style.visibility="hidden")}var d,m,y,date,type="",distance,twokm,threekm,fourkm,region="",prefecture="",prefecture_select="",sub_prefecture="",geoData=null,dataLayer=null,markerGroup=null,guineaAdminLayer0,guineaAdminLayer1,guineaAdminLayer2,region_layer=null,prefecture_layer=null,sub_prefecture_layer=null,bufferLayer=null,substance_layer=null,GINLabels=[],within,within_fc,buffered=null,GINAdmin2=!1,googleSat=L.tileLayer("https://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}",{maxZoom:20,subdomains:["mt0","mt1","mt2","mt3"]}),googleStreets=L.tileLayer("https://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}",{maxZoom:20,subdomains:["mt0","mt1","mt2","mt3"]}),osm=L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:18}),mapbox=L.tileLayer("https://api.mapbox.com/styles/v1/mapbox/satellite-streets-v9/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1Ijoicy1jaGFuZCIsImEiOiJjaXdmcmtnc2QwMDBhMnltczBldmc1MHZuIn0.eIdXZvG0VOOcZhhoHpUQYA"),map=L.map("map",{center:[9.6,-12.6],zoom:7,animation:!0,zoomControl:!1,layers:[osm]});map.options.minZoom=7;var baseMaps={"Google Satelite":googleSat,OSM:osm,"Google Street":googleStreets,"Map Box":mapbox};map.on("zoomend",function(){adjustLayerbyZoom(map.getZoom())}),new L.Control.Zoom({position:"topright"}).addTo(map),L.control.layers(baseMaps).addTo(map),L.control.scale({position:"bottomright",maxWidth:100,metric:!0,updateWhenIdle:!0}).addTo(map),$(function(){$("#btnPrint").click(function(){html2canvas($("#map"),{onrendered:function(e){theCanvas=e,document.body.appendChild(e),e.toBlob(function(e){saveAs(e,"Dashboard.png")})}})})}),getAdminLayers(),hideLoader();
//# sourceMappingURL=main.min.js.map
